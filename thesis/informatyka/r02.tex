\chapter{Protoko³y komunikacyjne (sieciowe)}
\label{r02}

W rozdziale tym przedstawiona zostanie architektura ISO/OSI stosu protoko³ów, dziêki którym wydajna i bezpieczna 
transmisja w sieci nie by³aby w ogóle mo¿liwa: od protoko³ów TCP/IP, poprzez SSL do protoko³ów FTP i HTTP. 
Opisany zostanie tak¿e sposób identyfikacji i komunikacji urz±dzeñ i zasobów sieciowych na ró¿nych warstwach 
czyli DNS i URL. Najwiêcej uwagi po¶wiêcone zostanie na opis protoko³u HTTP i sposób dzia³ania WWW.

\section{Wstêp}

Podstawow urz±dzenia komunikacyjne sk³adaj± siê z elementów, które przesy³aj± bity z jednego miejsca do drugiego. Jednak¿e
u¿ywanie ,,surowego'' sprzêtu do komunikacji jest podobne do programowania przez wrowadzanie zer i jedynek -- jest to 
nieporêczne i niewygodne. Komputery pod³±czone do sieci s± wyposa¿one w skomplikowane oprogramowanie udostêpniej±ce
wygodny, wysokopoziomowy interfejs dla programów u¿ytkownika. Oprogramowanie to obs³uguje automatycznie wiêkszo¶æ 
niskopoziomowych szczegó³ów oraz problemów, co pozwala na ³atw± komunikacjê miêdzy programami u¿ytkowymi. W ten sposób
wiêkszo¶æ programów u¿ytkownika przy komunikacji polega na oprogramowaniu sieciowym i nie komunikuje siê bezpo¶rednio ze
sprzêtem.

Wszystkie strony bior±ce udzia³ w komunikacji musz± uzgodniæ zbiór regu³ u¿ywanych przy wymianie komunikatów. Zbiór regu³, 
które okre¶laj± format komunikatów, oraz stosownych dzia³añ wymaganych dla ka¿dego komunikatu nazywa siê protoko³em sieciowym.

\section{TCP/IP a ISO/OSI}

Aby sprawienie i efektywnie rozwi±zaæ dowolne zadanie komunikacyjne oraz zaplanowaæ zestaw 
protoko³ów stworzono model warstwowy \cite{siecikomputerowe}.
Zestaw protoko³ów mo¿na tym samym zwi±zaæ z okre¶lon± warstw± \cite{barylo1}.

Wcze¶nie w historii sieci \emph{International Organization for Stadarization} (ISO) opracowa³a model 7--warstwowy.
Model ISO/OSI jest standardem stanowi±cym punkt odniesienia dla producentów oprogramowania i sprzêtu sieciowego. 
Stosowanie siê do zaleceñ tego standardu zapewniæ ma kompatybilno¶æ ró¿nych produktów sieciowych, co implikuje 
mo¿liwo¶æ swobodnego ich ³±czenia w tzw. system otwarty.
Wyró¿niæ w nim mo¿na: warstwê aplikacji, prezentacji i sesji -- nazywane warstwami górnymi, oraz
warstwê transportow±, sieciow±, ³±cza danych i fizyczn± -- nazywane warstwami dolnymi. Warstwy górne zajmuj± siê 
wspó³prac± procesów wykonuj±cych siê w po³±czonych sieci± komputerach. Warstwy dolne zapewniaj± prawid³ow± 
komunikacjê pomiêdzy procesami. W ka¿dej z warstw pracuje odpowiednie oprogramowanie realizuj±ce funkcje 
protoko³u danej warstwy. Protoko³y poszczególnych warstw oferuj± okre¶lony rodzaj us³ug \cite{siecikomputerowe}:
\begin{description}
\item[warstwa aplikacji] -- okre¶la sposób, w jaki dany program u¿ytkowy korzysta z sieci np.: w wastwie tej dzia³a protokó³ 
HTTP;
\item[warstwa prezentacji] -- protoko³y tej warstwy okre¶laj± jak prezentowaæ dane. Takie protoko³y s± potrzebne gdy¿ ró¿ne
marki komputerów u¿ywaj± ró¿nej wewnêtrznej reprezentacji liczb i znaków -- protoko³y tej warstwy t³umacz± reprezentacjê
na jednej maszynie na reprezentacjê na drugiej;
\item[warstwa sesji] -- odpowiedzialna jest za synchronizacjê danych przesy³anych pomiêdzy aplikacjami, dziêki 
udostêpnianym w tej warstwie tzw. punktom synchronizacji aplikacje s± w stanie wzajemnie rozpoznaæ stan 
zaawansowania w przetwarzaniu wymienianych danych, umo¿liwia to wykrycie takich sytuacji jak np. spowodowane 
awari± zaprzestanie przetwarzania przez stowarzyszon± aplikacjê;
\item[warstwa transportowa] -- protoko³y wastwy czwartej okre¶laj± szczegó³y obs³ugi po³±czenia -- s± jednymi z najbardziej
skomplikowanych protoko³ów;
\item[warstwa sieciowa] --  protoko³y tej warstwy okre¶laj± sposób przyznawania adresów oraz przekazywania pakietów w sieci;
\item[warstwa ³±cza danych] -- protoko³y tej warstwy okre¶laj± sposób organizowania ramek i transmitowania ich przez sieæ np.:
opis formatu ramki, rozpychania bitów lub bajtów oraz obliczania sum kontrolnych;
\item[warstwa  fizyczna] -- realizuje mechaniczne, elektryczne, funkcjonalne i proceduralne aspekty transmisji 
danych, czyli definiuje medium transmisyjne takie jak np. kabel miedziany.
\end{description}

Ka¿da z warstw udostêpnia warstwie bezpo¶rednio wy¿szej zestaw funkcji realizuj±cych  zadania danej warstwy i 
korzysta z zestawu funkcji udostêpnianych przez warstwê bezpo¶rednio ni¿sz±. Nie jest mo¿liwe by np. warstwa 
transportowa korzysta³a z funkcji warstwy ³±cza danych z pominiêciem warstwy sieciowej. Porcjê danych 
przeznaczonych do wys³ania nazywa siê pakietem. Wysy³any pakiet musi przej¶æ kolejno przez wszystkie warstwy 
modelu ISO/OSI od warstwy aplikacji do warstwy fizycznej. W trakcie tej wêdrówki pakiet obrasta w informacje 
kontrolne umo¿liwiaj±ce protoko³owi danej warstwy zarz±dzanie danymi i po³±czeniami, tê informacjê kontroln± 
nazywamy nag³ówkiem lub koñcówk± w zale¿no¶ci od tego, czy jest dodawana na pocz±tku, czy na koñcu danych. 
Nag³ówek warstwy wy¿szej traktowany jest w warstwie ni¿szej jako czê¶æ danych i nie podlega tam ¿adnym zmianom. 
Pakiet odbierany odbywa drogê odwrotn± -- od warstwy fizycznej do warstwy aplikacji. W trakcie tej drogi 
protoko³y poszczególnych warstw usuwaj± swoje nag³ówki, tak aby do aplikacji docelowej pakiet dotar³ w takiej 
postaci, w jakiej zosta³ wys³any. Poni¿szy rysunek schematycznie przedstawia opisany proces.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/nadawanie_i_odbieranie_naglowkow.eps}
\caption{Proces nadawania i odbierania nag³ówków transmitowanym danym}
\label{nadawanie}
\end{figure}

Protoko³y poszczególnych warstw zarz±dzaj± danymi w specyficzny dla siebie sposób, mog± np. dokonaæ segmentacji, 
czyli podzia³u danych na mniejsze fragmenty przed przes³aniem ich do ni¿szej warstwy. Ka¿dy fragment otrzymuje 
wtedy odpowiedni nag³ówek, który umo¿liwia analogicznemu protoko³owi w komputerze adresata danych scalenie 
fragmentów podczas odbierania pakietu. Nag³ówki umo¿liwiaj± równie¿ zarz±dzanie po³±czeniami np. 
multipleksowanie po³±czeñ czyli wykorzystywanie jednego po³±czenia, ¶ci¶lej -- punktu dostarczania us³ug SAP 
(ang. \emph{Service Access Point})  warstwy ni¿szej, np. sieciowej do obs³ugi kilku po³±czeñ nawi±zanych w warstwie 
bezpo¶rednio wy¿szej (tu transportowej). Odpowiednia informacja zawarta w nag³ówku warstwy wy¿szej umo¿liwia 
wtedy identyfikacjê odbiorcy danych. Model ISO/OSI definiuje dwa tryby komunikacji. Komunikacje po³±czeniow± 
stosuje siê gdy kluczowym wymaganiem jest niezawodno¶æ transmisji, musi byæ wtedy znany zarówno odbiorca jak i 
nadawca danych, a odbiorca potwierdza dotarcie do niego ka¿dego fragmentu pakietu lub sygnalizuje konieczno¶æ 
retransmisji w przypadku b³êdu. Komunikacja bezpo³±czeniowa nie zapewnia niezawodno¶ci, dane wysy³a siê bez 
oczekiwania na potwierdzenie, a nadawca  i odbiorca nie s± znani, chyba ¿e wynika to z zawarto¶ci pakietu, 
pakiety wysy³ane w trybie bezpo³±czeniowym nazywamy datagramami.

W praktyce nie istnieje rozwi±zanie przemys³owe, które ¶ci¶le implementowa³oby wszystkie warstwy modelu ISO/OSI, 
czêst± praktyk± jest np. ³±czenie warstw fizycznej i ³±cza danych w jedn± warstwê. Równie¿ protoko³y TCP/IP nie 
s± w pe³ni kompatybilne z modelem ISO/OSI, nie s± te¿ jednak ca³kowicie niekompatybilne. Wzajemn± relacjê 
architektury ISO/OSI i TCP/IP przedstawia poni¿szy rysunek \cite{barylo1}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/architektura_ISO_a_tcp.eps}
\caption{Architektura ISO/OSI a TCP/IP}
\label{ISO_TCP}
\end{figure}
\section{Protokó³ IP}

Protokó³ IP (ang. \emph{Internet Protocol}) dzia³a w warstwie sieciowej i jest podstawowym protoko³em rodziny TCP/IP --
wszystkie dane nap³ywaj±ce z wy¿szych warstw przesy³ane s± w sieci jako datagramy IP. Protokó³ ten ¶wiadczy 
zawodne, bezpo³±czeniowe us³ugi dostarczania pakietów. Przez zawodne rozumiemy tu tak± w³a¶ciwo¶æ, ¿e IP nie 
daje gwarancji dostarczenia pakietu do punktu przeznaczenia, a wszelkie mechanizmy zapewnienia niezawodno¶ci transmisji musz±
zostaæ zapewnione przez protoko³y wy¿szych warstw (np. TCP). Termin bezpo³±czeniowy oznacza tu, ¿e IP nie 
przechowuje ¿adnej informacji na temat prawid³owo przesy³anych datagramów, ka¿dy z nich obs³ugiwany jest osobno, 
co w praktyce mo¿e oznaczaæ, ¿e datagramy mog± docieraæ do adresata w innej kolejno¶ci, ni¿ zosta³y wys³ane. 
Wszystkie dane konieczne do poprawnej pracy IP zawarte s± w jego nag³ówku, który typowo (je¶li nie zawiera 
opcji) ma d³ugo¶æ 20 bajtów i przedstawiony poni¿ej format \cite{barylo2}.

\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/datagram_ip.eps}
\caption{Format datagramu IP z wyró¿nieniem nag³ówka}
\label{datagram_ip}
\end{figure}

Pole \emph{d³ugo¶æ nag³ówka} okre¶la d³ugo¶æ nag³ówka w 32--bitowych s³owach i wraz z polem D³ugo¶æ ca³kowita datagramu 
s³u¿y do okre¶lenia miejsca w którym zaczynaj± siê w³a¶ciwe dane. Ca³kowita d³ugo¶æ datagramu ograniczona jest 
zwykle przez warstwê fizyczn± np. dla sieci Ethernet jest to maksymalnie 1500 bajtów a wielko¶æ tê nazywamy MTU 
(ang. \emph{Maximum Transmission Unit}) danej sieci.

Pole \emph{identyfikacja} zawiera unikalny numer dla ka¿dego wysy³anego datagramu. Je¿eli przechodz±c przez kolejne 
wêz³y sieci datagram musi zostaæ podzielony, to warto¶æ ta jest kopiowana do wszystkich nag³ówków IP 
powstaj±cych fragmentów i wraz z warto¶ci± pola Przesuniêcie fragmentu umo¿liwia poprawne scalenie datagramu w 
punkcie docelowym. Pomocne s± w tym równie¿ warto¶ci bitów pola Znaczniki. Ustawienie jednego z nich wskazuje, 
¿e istnieje kilka fragmentów datagramu, ustawienie drugiego zabrania fragmentacji datagramu.

Pole \emph{czas ¿ycia TTL} wyznacza  maksymaln± liczbê routerów przez które mo¿e przej¶æ datagram (routerem 
nazywamy tu specjalizowane urz±dzenie lub odpowiednio oprogramowany komputer s³u¿±ce do przekazywania datagramów 
pomiêdzy sieciami ró¿ni±cymi siê w warstwie fizycznej np. Ethernet i Token Ring, lecz pracuj±cymi w oparciu o 
wspólny protokó³ warstwy sieciowej - IP). Warto¶æ tego pola jest wielko¶ci± ca³kowit± zmniejszan± o jeden przez 
ka¿dy router, do którego dociera datagram. Datagram z warto¶ci± TTL równ± 0 usuwany jest z sieci, co zapobiega 
kr±¿eniu w niej b³êdnie zaadresowanych datagramów.

Pole \emph{protokó³} okre¶la typ protoko³u bêd±cego nadawc± datagramu i jednocze¶nie protokó³ który powinien 
odebraæ datagram w punkcie docelowym.

Kluczowe znaczenie dla wyznaczania trasy przesy³ania datagramu maj± pola \emph{adres docelowy} i \emph{adres ¼ród³owy}. Na 
podstawie warto¶ci pola Adres docelowy protokó³ IP dynamicznie wyznacza kolejny wêze³ sieci na drodze pakietu, 
proces ten nazywamy marszrutowaniem IP. Adres IP jest 32--bitowym numerem, który w sposób unikalny wyznacza 
miejsce pod³±czenia interfejsu sieciowego (karty sieciowej) do sieci. W adresie IP wyró¿niamy czê¶æ globaln± 
okre¶laj±c± adres sieci i czê¶æ lokaln± identyfikuj±c± komputer w konkretnej sieci. Istnieje piêæ klas adresów IP (Rys.: \ref{klasy_ip}):
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/klasy_adresow.eps}
\caption{Klasy adresów IP}
\label{klasy_ip}
\end{figure}

Aby zapewniæ unikalno¶æ adresów sieci przydzielane s± one centralnie przez organizacjê InterNIC. Adres zapisuje
siê zwykle w tzw. notacji kropkowo -- dziesiêtnej, dzieli siê go na cztery o¶miobitowe  grupy i warto¶æ ka¿dej z 
nich zapisuje dziesiêtnie np.156.17.130.10 jest adresem serwera pocztowego Instytutu Sterowania i Techniki Systemów
Politechniki Wroc³awskiej.

Istniej± trzy typy adresów IP: adres unicast dotyczy pojedynczego komputera, adres broadcast dotyczy 
wszystkich komputerów w danej sieci a adres multicast obejmuje grupê komputerów nale¿±cych do jednej grupy 
multicastowej. Obecnie wszystkie implementacje IP musz± obs³ugiwaæ tzw. adresowanie podsieci. Zamiast traktowaæ 
adres IP jako proste z³o¿enie adresu sieci i hosta (komputera) w czê¶ci adresu wskazuj±cej hosta wydziela siê 
adres podsieci i w³a¶ciwy adres hosta. Wynika to z faktu, ¿e adresy klasy A i B przeznaczaj± zbyt wiele bitów na 
adres hosta, adres klasy B umo¿liwia np. zaadresowanie 65535 komputerów, a rzadko spotyka siê tak wiele hostów 
pod³±czonych do jednej sieci. Podzia³ 16 bitowego adresu hosta klasy B na dwie czê¶ci o¶miobitowe umo¿liwia 
utworzenie w jednej sieci 255 podsieci z 254 hostami w ka¿dej z nich. Decyzjê o podziale na podsieci podejmuje 
lokalny administrator, a informacjê o tym jaka ilo¶æ bitów przeznaczona jest na adres podsieci przechowywana 
jest przez tzw. maskê podsieci. Jest to warto¶æ 32--bitowa  zawieraj±ca jedynki dla czê¶ci adresuj±cej sieæ i 
podsieæ oraz zera dla czê¶ci adresuj±cej hosta. Maska podsieci ma w omówionym przypadku postaæ 255.255.255.224.

Istnieje kilka zarezerwowanych adresów IP wykorzystywanych do celów specjalnych. Obowi±zkowym adresem 
specjalnym jest adres interfejsu pêtli zwrotnej (ang. \emph{loopback}). Wiêkszo¶æ systemów przypisuje temu interfejsowi 
z definicji adres 127.0.0.1, choæ poprawny jest dowolny adres klasy A z adresem sieci 127. Datagramy kierowane 
na adres pêtli zwrotnej przechodz± przez warstwê transportow± i sieciow± po czym s± zawracane w górê stosu 
TCP/IP. Najczêstszym zastosowaniem pêtli zwrotnej jest testowanie poprawno¶ci dzia³ania protoko³ów TCP/IP. 
Niektóre systemy (np. system AIX) umo¿liwiaj± dodawanie aliasów (dodatkowych adresów) do adresu interfejsu pêtli 
zwrotnej.

Ka¿dy komputer (host) pod³±czony do sieci IP posiada co najmniej jeden adres IP, hosty posiadaj±ce kilka 
interfejsów sieciowych posiadaj± po jednym adresie dla ka¿dego interfejsu. Wszystkie te adresy, wraz z adresami 
specjalnymi i adresami typu broadcast przechowywane s± w tzw. tablicy marszrutowania (routingu). Protokó³ IP po otrzymaniu 
datagramu sprawdza, czy jego adres IP zgodny jest z którym¶ z adresów hosta lub jednym z adresów specjalnych. 
Je¶li tak jest datagram zostaje zaakceptowany. Postêpowanie w przeciwnym wypadku zale¿y od tego, czy warstwa IP 
skonfigurowana jest jako router. Je¿eli host nie jest routerem nastêpuje odrzucenie datagramu, w przeciwnym wypadku
uruchamiany jest opisany poni¿ej algorytm marszrutowania.

Marszrutowanie IP dokonywane jest na podstawie kolejnych przej¶æ pomiêdzy wêz³ami sieci zapisanych (wraz z 
adresami w³asnymi hosta) w tablicy marszrutowania. Pojedynczy rekord tablicy routingu zawiera znany adres 
docelowy IP i adres IP na który nale¿y skierowaæ datagram je¶li jego adres docelowy jest zgodny z adresem 
zapisanym w rekordzie. Je¿eli nadawca i odbiorca s± bezpo¶rednio po³±czeni rekord tablicy marszrutowania zawiera 
wskazanie (w postaci adresu IP) na adresata datagramu, o czym informuje specjalny znacznik w danym rekordzie. 
W przeciwnym wypadku jest to adres routera stanowi±cego po³±czenie z inn± sieci± lokaln± lub punkt wyj¶cia do 
sieci rozleg³ej. Zak³ada siê ¿e router taki znajduje siê bli¿ej punktu docelowego datagramu, gdy¿ IP nie zna 
pe³nej trasy dla ¿adnego z datagramów adresowanych poza sieæ lokaln±. Wybór drogi datagramu przebiega 
nastêpuj±co \cite{barylo2}: 
w pierwszej kolejno¶ci poszukiwany jest rekord zawieraj±cy w pe³ni zgodny adres docelowy IP. Je¶li zostanie on 
znaleziony, datagram jest wysy³any na adres wskazany przez rekord. Mo¿e byæ to adres docelowy lub znane 
przej¶cie przez router do innej sieci lokalnej.
Nastêpnie w tablicy marszrutowania  poszukiwany jest rekord z adresem sieci zgodnym z adresem sieci 
marszroutowanego datagramu. Je¶li poszukiwania zakoñcz± siê sukcesem datagram jest wysy³any na zawarty tam adres. 
W ten sposób mog± byæ obs³ugiwane  datagramy zaadresowane do hostów po³±czonych z nadawc± przez wspóln± sieæ 
(w sensie zgodno¶ci adresów globalnych IP). 
W przypadku niepowodzenia poprzednich poszukiwañ datagram wysy³any jest na adres IP routera domy¶lnego.

Ostatni± czynno¶ci± dokonywan± zanim datagram rzeczywi¶cie opu¶ci komputer nadawcy jest ustalenie jego adresu 
fizycznego w danej sieci lokalnej (np. adresu Ethernet lub Token Ring). Ka¿de urz±dzenie: komputer, router, czy 
most (bridge) posiada unikalny w obszarze danej sieci lokalnej adres fizyczny. Odwzorowanie adresu IP w adres fizyczny 
dokonuje siê przy u¿yciu protoko³u ARP (ang. \emph{Address Resolution Protocol}), opis jego dzia³ania le¿y poza 
zakresem tej pracy.
Wypada zaznaczyæ, ¿e adresy IP klasy B wyczerpa³y siê w roku 1997, co wymusi³o wprowadzenie nowej specyfikacji
protoko³u IP tzw. IPv6, który wprowadza adresy 128 bitowe. 

\section{Protokó³ TCP}

Protokó³ TCP (ang. \emph{Transmission Control Protocol}) zapewnia niezawodne, zorientowane 
po³±czeniowo, oparte na strumieniach bajtów (tzn. nie stosuj±ce ¿adnego arbitralnego podzia³u przesy³anych 
danych na jednostki sta³ej d³ugo¶ci) us³ugi warstwy transportowej. Przed rozpoczêciem transmisji dwie aplikacje 
u¿ywaj±ce TCP musz± ustanowiæ po³±czenie w postaci wirtualnego kana³u transmisyjnego. Niezawodno¶æ tego 
po³±czenia zapewniana jest przez dzia³ania takie jak: podzia³ przesy³anych danych na segmenty o rozmiarze 
optymalnym ze wzglêdu na poprawno¶æ transmisji; utrzymywanie dla ka¿dego segmentu osobnego zestawu zegarów 
wyznaczaj±cych m. in. maksymalny czas oczekiwania na potwierdzenie odbioru segmentu i wymuszaj±cego retransmisjê 
w przypadku przekroczenia tego czasu; u¿ywanie obowi±zkowych sum kontrolnych; odrzucanie zdublowanych 
datagramów IP; zdolno¶æ rozpoznania kolejno¶ci datagramów IP (mog± one docieraæ w kolejno¶ci innej ni¿ by³y 
wysy³ane).

Informacjê kontroln± segmentu TCP zawiera przedstawiony poni¿ej nag³ówek \cite{barylo2}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/format_segmentu_tcp.eps}
\caption{Format segmentu TCP z wyró¿nieniem nag³ówka.}
\label{segment_TCP}
\end{figure}

Pola \emph{numer portu ¼ród³owego} i \emph{numer portu docelowego} zawieraj± wielko¶ci ca³kowite i pe³ni± kluczow± rolê w 
identyfikacji po³±czeñ TCP. Numery portów od 1 do 1023 s± zarezerwowane dla tzw. us³ug dobrze znanych i 
zazwyczaj przydzielane s± aplikacjom pracuj±cym jako serwery. Przyk³adowo serwery WWW (protokó³ HTTP) otrzymuj± 
numer portu 80, serwery FTP wykorzystuj± porty 20 i 21 a serwery pocztowe (SMTP) port 25. Do nawi±zania 
po³±czenia proces klienta (np. przegl±darka WWW) uzyskuje od protoko³u TCP tzw. numer krótkotrwa³y unikalny dla 
ka¿dej aplikacji u¿ywaj±cej TCP w danym ho¶cie. W przypadku przegl±darki WWW mo¿e byæ to numer 80 lub dowolny 
numer z zakresu 1024... 5000. Para port ¼ród³owy -- port docelowy jest wystarczaj±ca do identyfikacji po³±czenia 
po stronie klienta. Je¶li nawet u¿ytkownik uruchomi dwie identyczne aplikacje (np. dwie przegl±darki WWW), to 
otrzymaj± one ró¿ne numery krótkotrwa³e. Po stronie serwera sytuacja jest trudniejsza, typowo serwer poprzez 
multipleksacjê portu obs³uguje wiele po³±czeñ z u¿yciem jednego numeru portu ¼ród³owego (np. 80 dla serwera WWW),
mo¿e siê wiêc zdarzyæ, ¿e dwóch niezale¿nych klientów zg³osi ten sam numer krótkotrwa³y portu docelowego. Do 
jednoznacznej identyfikacji po³±czeñ wykorzystuje siê kombinacjê numeru portu i adresu IP nazywan± gniazdem. 
Gniazda s± jednym z podstawowych pojêæ interfejsu programisty TCP/IP.

Jak ju¿ wspomniano TCP przesy³a dane w postaci strumienia bajtów, w praktyce oznacza to, ¿e wysy³any 
segment danych mo¿e mieæ ka¿dorazowo inn±  d³ugo¶æ. Do umo¿liwienia uformowania z segmentów oryginalnego pakietu 
s³u¿y warto¶æ pola \emph{numer sekwencyjny}. Je¶li rozpatrzymy strumieñ bajtów przesy³any tylko w jedn± stronê, to 
warto¶æ tego pola okre¶la  numer jaki ma w strumieniu ostatni bajt segmentu. Warto¶æ pocz±tkow± numeru 
sekwencyjnego ustala nadawca w momencie ustanawiania po³±czenia. Je¶li pocz±tkowym numerem sekwencyjnym by³o 
100, a pierwszy segment ma d³ugo¶æ 1024 bajty, to jego numerem sekwencyjnym jest 1123. Pierwszy bajt kolejnego 
segmentu sk³adaj±cego siê na pakiet bêdzie mia³ numer 1124, je¶li segment ten ma d³ugo¶æ 125 bajtów, to jego 
numerem sekwencyjnym jest 1248. Koniec strumienia oznacza siê przez ustawienie flagi bitowej FIN w nag³ówku 
ostatniego segmentu.

TCP wymaga potwierdzeñ odbioru ka¿dego przes³anego segmentu. S³u¿y do tego pole \emph{numer potwierdzenia}. Je¶li 
znów rozpatrywaæ przesy³anie danych w jedn± tylko stronê, to po odebraniu segmentu o numerze sekwencyjnym 1123 
klient wysy³a (pozbawiony danych) segment TCP z ustawion± flag± bitow± ACK i warto¶ci± numeru potwierdzenia 1124 
(jest to numer kolejny oczekiwanego bajtu). Aby zapewniæ niezale¿ne przesy³anie danych w obydwu kierunkach, 
ka¿da ze stron pamiêta numery sekwencyjne wymienianych segmentów. Opisany powy¿ej segment potwierdzenia posiada 
wiêc ustalany przez jego nadawcê numer sekwencyjny (np. 136), który serwer musi potwierdziæ ustawiaj±c flagê ACK 
i umieszczaj±c w polu Numer sekwencyjny odpowiedni± warto¶æ (tutaj 137). Konsekwencj± takiej strategii wymiany 
potwierdzeñ jest fakt, ¿e w trakcie wymiany danych flaga ACK jest ci±gle ustawiona (ma warto¶æ logiczn± 1).
Pole D³ugo¶æ nag³ówka zawiera liczbê 32--bitowych s³ów sk³adaj±cych siê na nag³ówek, nastêpuje po nim 6 
zarezerwowanych bitów i kolejno 6 flag bitowych. Istotn± flag± jest SYN, która jest ustawiona podczas wymiany 
segmentów nawi±zuj±cych po³±czenie i ustalania pocz±tkowych numerów sekwencyjnych. 

Pole \emph{rozmiar okna} zawiera warto¶æ ca³kowit±, przy pomocy której odbiorca deklaruje jak± ilo¶æ bajtów 
nadawca mo¿e wys³aæ bez oczekiwania na potwierdzenie (inaczej -- jak± ilo¶æ bajtów odbiorca jest w stanie przyj±æ 
jednorazowo). Pole ma zastosowanie w przypadku transmisji wg tzw. protoko³u przesuwnego okna, a jego warto¶æ 
mo¿e siê zmieniaæ w trakcie  transmisji.

Wa¿n± rolê w trakcie nawi±zywania po³±czenia pe³ni pole \emph{opcje}. W polu tym uczestnicy po³±czenia wymieniaj± 
siê informacj± jak du¿y jest pojedynczy segment, który s± w stanie przyj±æ. Ustalone w ten sposób maksymalne 
wielko¶ci segmentu MSS (ang. \emph{Maximum Segment Size}) pozostaj± sta³e dla obydwu koñcówek po³±czenia przez ca³y 
czas jego trwania. 

Warto¶æ tê ustala siê z uwzglêdnieniem nak³adanego przez warstwê fizyczn± ograniczenia na maksymalny rozmiar 
datagramu IP (MTU).

Aby móc zarz±dzaæ po³±czeniami oprogramowanie protoko³u TCP utrzymuje tablicê po³±czeñ. Pojedynczy rekord takiej 
tablicy opisuje jedno po³±czenie i zawiera pola: 
\begin{itemize}
\item Status (zamkniête, w trakcie zamykania, oczekiwanie na potwierdzenie itp.)
\item Adres lokalny -- adres IP hosta ¼ród³owego (przechowuj±cego tablicê)
\item Port lokalny -- numer portu hosta ¼ród³owego
\item Adres zdalny -- adres IP hosta docelowego
\item Port zdalny -- numer portu docelowego
\end{itemize}

Protokó³ TCP wykorzystywany jest przez wiele protoko³ów wy¿szych warstw, dla których najistotniejsz± spraw± jest 
zapewnienie niezawodno¶ci transmisji. TCP u¿ywaj± m. in. HTTP, FTP czy SMTP, które zostan± krótko omówione w 
dalszej czê¶ci tej pracy. System DNS korzysta z protoko³u TCP podczas wymiany danych pomiêdzy serwerami DNS w 
trakcie uaktualniania ich tablic odwzorowañ.

\section{Protokó³ UDP}

Protokó³ UDP (ang. \emph{User Datagram Protocol}) jest prostym, bezpo³±czeniowym protoko³em warstwy transportowej 
wykorzystuj±cym datagramy. Z ka¿dego pakietu danych skierowanego do UDP przez warstwy górne formowany jest 
jeden datagram UDP, z którego (inaczej ni¿ w przypadku TCP) tworzony jest dok³adnie jeden datagram IP. Aplikacja 
wysy³aj±ca pakiet musi sama zadbaæ o to, by jego d³ugo¶æ nie przekroczy³a MTU. UDP (w przeciwieñstwie do TCP) 
nie implementuje ¿adnych mechanizmów zapewniaj±cych niezawodno¶æ transmisji.  Nag³ówek datagramu UDP ma bardzo 
prosty format \cite{barylo2}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/datagram_udp.eps}
\caption{Datagram UDP z wyró¿nionym nag³ówkiem.}
\label{datagram_udp}
\end{figure}
 
\section{Protokó³ FTP}

Protokó³ FTP (ang. \emph{File Transfer Protocol}) jest standardowym w Internecie protoko³em przesy³ania dowolnego 
rodzaju plików. Jest to protokó³ warstw wy¿szych, i przez to jest czêsto b³êdnie uto¿samiany z aplikacjami 
klienta FTP. FTP korzysta w warstwie transportowej z us³ug protoko³u TCP. Do obs³ugi transmisji FTP, w 
przeciwieñstwie do wiêkszo¶ci protoko³ów, otwiera a¿ dwa po³±czenia TCP : po³±czenie steruj±ce o numerze portu 
docelowego 21 i po³±czenie transmisji danych o numerze portu 20. Przez po³±czenie steruj±ce aplikacje FTP 
wymieniaj± zdefiniowane w protokole polecenia i potwierdzenia. Po³±czenie transmisji u¿ywane jest do binarnego 
przesy³ania danych. Schemat obs³ugi po³±czenia przez procesy klienta i serwera FTP przedstawia rysunek \ref{polaczenie_ftp}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/obsluga_ftp.eps}
\caption{Obs³uga po³±czenia ftp.}
\label{polaczenie_ftp}
\end{figure}

Po³±czenie przesy³ania danych nawi±zywane jest dla ka¿dego przesy³anego pliku. FTP mo¿e przesy³aæ pliki w 
jednym z trzech trybów: jako strumieñ bajtów, jako seriê bloków podzielonych nag³ówkami lub w rzadko stosowanym 
trybie z kompresj± FTP (kompresji podlegaj± tylko ci±gi zerowych bajtów). FTP rozpoznaje formaty ASCII i EBCDIC 
-- przesy³ane s± one w postaci rekordów o sta³ej d³ugo¶ci, pozosta³e pliki traktowane s± jako pliki binarne i 
przesy³ane jako strumieñ bajtów.

Polecenia FTP wymieniane przez po³±czenie steruj±ce maj± postaæ ci±gów wielkich liter ASCII o d³ugo¶ci 3 
lub 4 bajtów. Ka¿de nawi±zanie po³±czenia z serwerem FTP wymaga podania nazwy u¿ytkownika i has³a, jest to 
prosty mechanizm zapewniaj±cy kontrolê dostêpu do zasobów serwera. O tym, jakie pliki udostêpniaæ konkretnym 
u¿ytkownikom decyduje administrator serwera FTP.
Wed³ug badañ prowadzonych w szkieletowej sieci NSFNET dane FTP stale stanowi± ok. 20\% pakietów 
transmitowanych w tej sieci. 

\section{Protokó³ SNMP}

Protokó³ SNMP (ang. \emph{Simple Network Management Protocol}) pierwotnie zaprojektowano jako uniwersalne narzêdzie, 
które umo¿liwi zdalne nadzorowanie ¶luz (ang. \emph{gateway})  i routerów w sieciach rozleg³ych. W miarê jego rozwoju 
protokó³ uzupe³niono o mo¿liwo¶æ zarz±dzania wszelkim typem urz±dzeñ sieciowych w sieciach TCP/IP. SNMP ka¿dej 
sieci opiera siê o trzy sk³adniki:
\begin{itemize}
\item MIB (ang. \emph{Management Information Base}) jest to baza danych opisuj±ca stan danego urz±dzenia;
\item SMI (ang. \emph{Structure and Identification of Management Information}) jest zestawem powszechnie stosowanych 
schematów s³u¿±cych odwo³ywaniu siê do zmiennych MIB;
\item SNMP okre¶la zasady komunikowania siê pomiêdzy aplikacj± zarz±dzaj±c± sieci± (serwerem SNMP), a procesem 
steruj±cym urz±dzeniem (agentem).
\end{itemize}

Ka¿dy element sieci, który ma byæ zarz±dzany przez SNMP, musi przechowywaæ informacjê o parametrach okre¶laj±cych
stan danego elementu, a maj±cych wp³yw na pracê sieci. Baza danych zawieraj±ca te parametry to w³a¶nie MIB. W 
przypadku urz±dzenia takiego jak router rekord MIB mo¿e np. zawieraæ informacjê o stopniu zape³nienia jego 
buforów pamiêci. MIB nie musi dotyczyæ elementów ¶ci¶le sprzêtowych istniej± np. MIB systemów operacyjnych. 
Sposób odwo³ywania siê do elementów MIB okre¶laj± schematy SMI.

W ka¿dej sieci, której elementy zarz±dzane s± wed³ug standardów SNMP istnieje wydzielony host, na którym 
pracuje specjalistyczna aplikacja (serwer SNMP) s³u¿±ca monitorowaniu i zarz±dzaniu prac± sieci. Proces, który 
dzia³a w zarz±dzanym elemencie i  aktualizuje MIB oraz udostêpnia serwerowi jej zmienne lub ustawia je na zadane 
przez serwer warto¶ci nazywany jest agentem SNMP.

W celu umo¿liwienia komunikacji pomiêdzy serwerem a agentami SNMP definiuje piêæ typów komunikatów. Trzy 
z nich wysy³ane s± zawsze w kierunku serwer--klient i s³u¿± pobieraniu lub ustawianiu zmiennych MIB. Dwa typy 
komunikatów wysy³ane s± w kierunku klient--serwer. Jeden z nich zwraca ¿±dan± lub nowo ustawion± warto¶æ 
zmiennej MIB, drugi jest komunikatem alarmowym wysy³anym przez agenta w przypadku b³êdnej pracy urz±dzenia lub 
przekroczenia krytycznej warto¶ci przez któr±¶ ze zmiennych MIB.
Serwer SNMP musi utrzymywaæ w miarê aktualn± informacjê o stanie sieci, dlatego agenci SNMP przepytywani 
s± w regularnych odstêpach czasu, posiadaj±c jednocze¶nie mo¿liwo¶æ raportowania o sytuacjach awaryjnych. Fakt, 
¿e cztery z piêciu mo¿liwych rodzajów komunikacji pomiêdzy serwerem a agentem SNMP to pary typu pojedyncze 
pytanie--pojedyncza odpowied¼ (wyj±tek stanowi± komunikaty alarmowe) oraz chêæ minimalizacji obci±¿enia sieci 
powodowanego przez pakiety s³u¿±ce jej zarz±dzaniu spowodowa³y, ¿e SNMP w warstwie transportowej korzysta z 
us³ug UDP. Zawodno¶æ tego protoko³u sprawia, ¿e serwery SNMP powinny (szczególnie w sytuacjach awaryjnych) 
stosowaæ mechanizmy odmierzania czasu na odpowied¼ agenta i ewentualnej retransmisji komunikatów. Warto dodaæ, 
¿e SNMP nie jest zale¿ny w warstwie sieciowej od IP, przy odpowiedniej konfiguracji rolê protoko³u sieciowego 
mo¿e spe³niaæ np. IPX/SPX.

\section{Protokó³ SMTP}

Protokó³ SMTP (ang. \emph{Simple Mail Transfer Protocol}) jest prostym protoko³em warstw górnych wykorzystywanym do 
przesy³ania poczty elektronicznej w sieciach TCP/IP. W warstwie transportowej SMTP wykorzystuje protokó³ TCP i 
posiada przydzielony numer portu 25. Nale¿y wyja¶niæ, ¿e programy pocztowe, z którymi kontaktuj± siê szeregowi 
u¿ytkownicy Internetu stanowi± jedynie koñcowe narzêdzia, w terminologii fachowej nazywane agentami u¿ytkownika 
UA (ang. \emph{User Agent}) s³u¿±ce do pobierania listów z elektronicznych skrzynek pocztowych lub umieszczania ich w 
kolejce do najbli¿szego serwera pocztowego. Programy rzeczywi¶cie zajmuj±ce siê przesy³aniem wiadomo¶ci pomiêdzy 
serwerami pocztowymi nazywane s± agentami przesy³ania komunikatów MTA (ang. \emph{Message Transfer Agent}). Przyk³adem 
MTA jest unixowy Sendmail. Protokó³ SMTP s³u¿y w³a¶nie do komunikacji pomiêdzy poszczególnymi MTA. Schemat 
przesy³ania poczty w Internecie przedstawia poni¿szy rysunek.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/obsluga_poczty.eps}
\caption{Schemat przesy³ania poczty elektronicznej}
\label{poczta}
\end{figure}

Komunikacja pomiêdzy MTA odbywa siê wed³ug modelu klient -- serwer, przy czym klientem nazywamy MTA, który inicjuje dane 
po³±czenie. Po³±czenie rozpoczyna siê od przes³ania danych identyfikuj±cych nadawcê, a w odpowiedzi nadchodzi pakiet 
identyfikuj±cy odbiorcê. Nastêpnie przesy³ana jest w³a¶ciwa wiadomo¶æ i po³±czenie jest zamykane. Do obs³ugi poczty 
elektronicznej SMTP definiuje tylko 13 poleceñ (dla porównania FTP posiada 40 poleceñ), które s± czterobajtowymi ci±gami 
wielkich liter ASCII.

Wiadomo¶æ elektroniczna sk³ada siê w SMTP z trzech czê¶ci. Koperty czyli danych pozwalaj±cych MTA zidentyfikowaæ 
nadawcê i odbiorcê wiadomo¶ci, nag³ówków czyli danych wykorzystywanych przez agentów u¿ytkownika (np. data 
wys³ania wiadomo¶ci) i w³a¶ciwej wiadomo¶ci.
Pakiety SMTP stanowi± od 8 do 13 procent pakietów transmitowanych w sieci szkieletowej NSFNET. 

\section{Protokó³ POP3.}

Opisany powy¿ej protokó³ SMTP jest efektywnym narzêdziem umo¿liwiaj±cym przesy³anie poczty elektronicznej 
pomiêdzy pracuj±cymi w sposób ci±g³y serwerami SMTP. Aby pojedynczy u¿ytkownik sieci móg³ odbieraæ pocztê 
bezpo¶rednio przez SMTP w jego stacji roboczej musia³by ci±gle dzia³aæ proces typu MTA, co jest czêsto 
niemo¿liwe ze wzglêdów czysto technicznych. Rozwi±zanie tego problemu jest bardzo proste. W pod³±czonych do 
Internetu sieciach lokalnych wydziela siê dzia³aj±cy non--stop  serwer pocztowy wraz z oprogramowaniem 
zachowuj±cym na dysku wiadomo¶ci nadchodz±ce do u¿ytkowników sieci. Protokó³ POP3 (ang. \emph{Post Office Protocol 
version 3}) umo¿liwia dynamiczny dostêp do wiadomo¶ci przechowywanych na takim wydzielonym serwerze \cite{barylo9}. Protokó³ ten 
korzysta z TCP i numeru portu 110. POP3 definiuje 13 poleceñ w postaci czterobajtowych ci±gów ASCII. 

Po³±czenie POP3 rozpoczyna siê od identyfikacji u¿ytkownika i podania has³a nastêpnie serwer i klient wymieniaj± 
dane po czym sesja koñczy siê.

Producenci aplikacji pocztowych (UA) stosuj± dwa protoko³y, SMTP do bezpo¶redniego wysy³ania poczty i POP3 
do odbierania jej z serwera pocztowego.

Pakiety POP3 najczê¶ciej spotkaæ mo¿na w sieciach lokalnych, gdzie mog± stanowiæ znaczny procent 
transmitowanych danych.

\section{Protokó³ SSL}

Protokó³ SSL (ang. \emph{Secure Socket Layer}) jest protoko³em rezyduj±cym bezpo¶rednio nad protoko³em TCP i 
dostarczaj±cym dowolnemu protoko³owi wy¿szych warstw (np. HTTP) przezroczyste us³ugi maj±ce zapewniæ poufno¶æ 
przesy³anych danych. SSL wykorzystuje port TCP o numerze 443. Bezpieczeñstwo po³±czenia oparte jest o trzy cechy 
protoko³u SSL: symetryczne szyfrowanie danych w oparciu o np. algorytmy DES lub RC4; autoryzacjê hostów z 
wykorzystaniem szyfrowania asymetrycznego lub z kluczem publicznym (RSA, DSS) i  kontrolê poprawno¶ci transmisji 
poprzez zastosowanie szyfrowanych sum kontrolnych MAC (ang. \emph{Message Autenthication Codes}).

W protokole SSL wyró¿niamy dwie warstwy: warstwê powitania i warstwê rekordów. Warstwa powitania (ang. \emph{Handshake Layer}) 
inicjuje po³±czenie 
pomiêdzy klientem a serwerem. Po wzajemnej identyfikacji hostów nastêpuje faza negocjacji algorytmów, które bêd± 
u¿yte do szyfrowania transmisji (wybór ten zale¿y od mocy obliczeniowej hostów). Od momentu ustalenia sposobu 
kodowania wszystkie dane s± szyfrowane.

Warstwa rekordów (ang. \emph{Record Layer}) rezyduje pomiêdzy warstw± powitania a TCP i jest odpowiedzialna za 
enkapsulacjê danych nap³ywaj±cych z wy¿szych warstw do postaci rekordów o maksymalnej d³ugo¶ci 16384 bajtów, 
szyfrowanie rekordów oraz do³±czanie MAC \cite{barylo10}.

Poniewa¿ SSL nie interpretuje nap³ywaj±cych do niego danych istnieje mo¿liwo¶æ przesy³ania hipertekstu z 
u¿yciem SSL. Tak skonfigurowany serwer WWW nazywamy serwerem HTTPS lub serwerem SSL. Szyfrowane s± wówczas 
wszystkie elementy  transmisji tzn. zarówno dokumenty jak i same polecenia HTTP, co wymaga odpowiedniej 
konfiguracji przegl±darki.

\section{URL i DNS}
	
U¿ytkownik Intrenetu do identyfikacji zasobów sieciowych stosuje zazwyczaj adres URL (ang. \emph{Uniform Resource 
Locator}). URL zapisujemy w postaci \cite{barylo5, barylo6}:\\
\emph{typ\_us³ugi://nazwa\_serwera.nazwa\_domeny/¶cie¿ka\_dostêpu/nazwa\_zasobu}. 
Na przyk³ad URL http://www.netscape.com/main.html jest wskazaniem na zapisany w postaci pliku HTML 
dokument hipertekstowy main.html znajduj±cy siê na ¶cie¿ce dostêpu (mo¿e byæ to nazwa katalogu lub jej alias) 
News/Sport w serwerze home umieszczonym w domenie netscape.com. Dokument ten dostêpny jest poprzez protokó³ 
HTTP.

Czê¶æ URL okre¶laj±ca typ us³ugi interpretowana jest przez aplikacjê u¿ywan± do po³±czenia z Internetem 
np. przegl±darkê WWW. ¦cie¿ka dostêpu i nazwa zasobu przesy³ane s± do serwera i interpretowane przez jego system 
plików. Nazwa serwera i nazwa domeny s± tylko nazwami symbolicznymi i musz± byæ zamienione na adres IP zanim 
zostanie nawi±zane po³±czenie z serwerem. Zamiana ta mo¿liwa jest dziêki systemowi DNS.

DNS (ang. \emph{Domain Name System}) jest rozproszon± baz± danych umieszczon± na wielu Internetowych hostach, 
które nazywamy serwerami DNS. Ka¿dy komputer, który chce korzystaæ z DNS musi pamiêtaæ w swojej konfiguracji 
adres IP najbli¿szego serwera DNS. Nazwa DNS mo¿e mieæ d³ugo¶æ do 63 znaków. Przestrzeñ nazw DNS ma strukturê 
hierarchicznego, podzielonego na poziomy drzewa. Mówimy, ¿e domena wy¿szego poziomu com zawiera domenê ni¿szego 
poziomu netscape. Rysunek \ref{dns} przedstawia hierarchiczn± organizacjê DNS \cite{barylo3}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/struktura_dns.eps}
\caption{Hierarchiczna struktura DNS}
\label{dns}
\end{figure}
																
Domeny arpa, com, edu, gov, int, mil, net, org i domeny pañstwowe takie jak pl nazywamy domenami podstawowymi. 
Obejmuj± one nastêpuj±ce komputery: arpa -- sieæ ARPANET; com -- organizacje komercyjne; edu -- instytucje edukacyjne; 
gov -- organizacje rz±dowe; int -- organizacje miêdzynarodowe; mil -- armia USA; net -- sieci; org -- pozosta³e 
organizacje. Organizacje rz±dowe z krajów innych ni¿ USA grupowane mia³y byæ w dwuliterowych domenach pañstwowych
np. ae -- Zjednoczone Emiraty Arabskie; pl -- Polska; zw -- Zimbabwe. Obecnie podzia³ ten nie jest ¶ci¶le 
przestrzegany, wiele organizacji komercyjnych rejestruje siê w domenie podstawowej (np. empik.com), inne stosuj± 
podzia³ w ramach domen pañstwowych (np. creamsoft.com.pl). spotyka siê równie¿ nazwy w ogóle nie mieszcz±ce siê 
w opisanym schemacie np. www.rmf.fm.

Obszarem nazywamy oddzielnie administrowan± czê¶æ drzewa DNS. Typowym obszarem jest domena drugiego lub 
trzeciego poziomu  np. netscape.com lub pwr.wroc.pl. Je¶li w domenie zarejestrowanych jest wiele komputerów 
zwykle (dla zwiêkszenia efektywno¶ci dzia³ania DNS) dzieli siê j± na kilka obszarów.

W ka¿dym obszarze musi znajdowaæ siê podstawowy serwer DNS, który w specjalnym zestawie plików przechowuje 
odwzorowania wszystkich nazw komputerów z danego obszaru w ich adresy IP. Drugoplanowe serwery DNS informacje o 
odwzorowaniach uzyskuj± z serwera podstawowego korzystaj±c z po³±czenia TCP o numerze portu 53. Serwery 
drugoplanowe przechowuj± (na zasadzie pamiêci cache dla klientów, którzy zwracaj± siê do nich z zapytaniami) 
odwzorowania obejmuj±ce tylko czê¶æ obszaru i odwzorowania o które klienci najczê¶ciej pytaj±. W sta³ych 
odstêpach czasu (typowo co 3 godziny) serwery drugoplanowe DNS uaktualniaj± swe tablice odpytuj±c serwer 
podstawowy. Odwzorowanie nazwy spoza obszaru nie musi byæ znane ani serwerowi podstawowemu, ani drugoplanowemu, 
chyba ¿e przechowywane jest w pamiêci cache (jest czêsto poszukiwane). Je¶li serwer podstawowy nie zna ¿±danego 
odwzorowania musi siê zwróciæ z zapytaniem (z wykorzystaniem portu 53 TCP) do jednego z serwerów g³ównych DNS 
(w 1993 roku by³o ich w Internecie 8), których obowi±zkiem jest wskazanie serwera DNS bêd±cego w stanie zwróciæ 
poprawne odwzorowanie.

Proces odpowiedzialny za odwzorowanie nazw po stronie klienta nazywamy rezolwerem lub przelicznikiem nazw. 
Zwykle jest on zintegrowany z aplikacj± (np. przegl±dark± WWW) i na zasadzie pamiêci cache przechowuje lokalnie 
pewn± ilo¶æ odwzorowañ. Je¶li wywo³ywana przez u¿ytkownika nazwa nie jest znana lokalnie rezolwer korzystaj±c z 
portu UDP 53 wysy³a zapytanie do najbli¿szego drugoplanowego serwera DNS. Je¶li odpowied¼ nie przekracza 512 
bajtów zwracana jest w postaci datagramu UDP, w przeciwnym wypadku jako datagram UDP wysy³ane jest pierwsze 512 
bajtów i w nag³ówku DNS ustawiana jest flaga informuj±ca o tym fakcie. Zazwyczaj rezolwer ponawia wtedy 
zapytanie korzystaj±c z portu 53 TCP, co umo¿liwia przes³anie pe³nej odpowiedzi w jednym segmencie TCP. Rezolwer 
mo¿e wys³aæ dwa typy zapytañ: zapytanie rekurencyjne umo¿liwia serwerowi DNS ,,konsultacje'' z serwerami wy¿szego 
rzêdu przed zwróceniem odpowiedzi; zapytanie iteracyjne wymaga od niego natychmiastowej odpowiedzi, która je¶li 
dany serwer nie zna odwzorowania, musi mieæ postaæ adresu IP serwera DNS bêd±cego (wedle ,,wiedzy'' zapytanego 
serwera DNS) w stanie udzieliæ poprawnej odpowiedzi. Ze wskazanym serwerem DNS resolwer komunikuje siê 
bezpo¶rednio. Poniewa¿ istnieje mo¿liwo¶æ, ¿e  nieprawid³owe zapytanie rekurencyjne nieskoñczenie bêdzie kr±¿yæ 
pomiêdzy serwerami DNS w nag³ówku DNS zdefiniowano pole ograniczaj±ce liczbê rekurencji. Warto¶æ tego pola 
zmniejszana jest o jeden przez ka¿dy serwer DNS, który przetwarza zapytanie. Zapytanie z zerow± warto¶ci± tego 
pola jest odrzucane i serwer komunikuje b³±d. W takim wypadku rezolwer mo¿e u¿yæ zapytania iteracyjnego, ponowiæ 
zapytanie rekurencyjne ze zwiêkszon± warto¶ci± pola ograniczaj±cego rekurencje lub zg³osiæ u¿ytkownikowi b³±d 
DNS. Rysunki \ref{rekurencyjne} i \ref{iteracyjne} przedstawiaj± obs³ugê obydwu typów zapytañ \cite{barylo3}.
\begin{figure}[h]
\centering
\includegraphics[width=4in]{./rysunki/zapytanie_rekurencyjne.eps}
\caption{Obs³uga zapytania rekurencyjnego}
\label{rekurencyjne}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=4in]{./rysunki/zapytanie_iteracyjne.eps}
\caption{Obs³uga zapytania iteracyjnego}
\label{iteracyjne}
\end{figure}

Powy¿sze rysunki przedstawiaj± ,,najgorszy'' przypadek, gdy adres IP serwera www.netscape.com znany jest dopiero 
przez podstawowy serwer DNS domeny (obszaru) netscape.com. W rzeczywisto¶ci istnieje du¿e prawdopodobieñstwo, ¿e 
odwzorowanie nazwy przechowywane jest przez pamiêæ cache jednego z bli¿szych klientowi serwerów.
Informacje o wzajemnych odwzorowaniach nazw w adresy IP serwery DNS przechowuj± w postaci rekordów zasobów 
DNS--DNS RR (ang. \emph{DNS Resource Record}). Rekordy te przesy³ane s± do aplikacji klienta jako odpowied¼ na 
zapytanie. Pojedynczy DNS RR ma przedstawion± na rys. \ref{dns_rr} strukturê \cite{barylo3}.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/format_dns_rr.eps}
\caption{Format DNS RR}
\label{dns_rr}
\end{figure}

Pole Nazwa domeny okre¶la domenê do której odnosz± siê dane rekordu. Pole Typ okre¶la rodzaj danych np. czy 
rekord przechowuje odwzorowanie nazwy w adres IP, adresu w nazwê, czy tylko dodatkowe informacje o ho¶cie. Pole 
Klasa ma zwykle warto¶æ 1, co oznacza internetowy adres IP (niektóre serwery DNS udostêpniaj± równie¿ adresy 
nale¿±ce do innych protoko³ów np. IPX/SPX). Pole Czas ¿ycia TTL jest liczb± sekund okre¶laj±c± maksymalny czas 
przechowywania rekordu w pamiêci cache rezolwera, niestety wiele aplikacji ignoruje tê warto¶æ.

\section{Protokó³ HTTP}

W tym rozdziale 
szczegó³owo omówiona jest specyfikacja protoko³u HTTP oraz te w³a¶ciwo¶ci protoko³u, które rzutuj± na wydajno¶æ WWW.

\subsection{Specyfikacja HTTP}
 
Protokó³ HTTP (ang. \emph{HyperText Transfer Protocol}) jest prostym protoko³em warstw górnych s³u¿±cym do przesy³ania 
dokumentów hipertekstowych w sieciach opartych o protoko³y TCP/IP. W warstwie sieciowej HTTP korzysta z TCP i 
portu o numerze 80 \cite{barylo4}. 

Jak wspomniano dokument hipertekstowy zawieraæ mo¿e obok tekstu równie¿ grafikê, animacje, d¼wiêki oraz 
odsy³acze do innych dokumentów hipertekstowych, które mog± znajdowaæ siê na innych serwerach WWW, w konsekwencji 
czêsto aby skompletowaæ ca³y dokument przegl±darka WWW musi otworzyæ wiele po³±czeñ z kilkoma serwerami WWW.

HTTP wykonuje tylko przesy³anie plików sk³adaj±cych siê na dokument hipertekstowy. Jest to zazwyczaj plik 
bêd±cy opisem dokumentu w jêzyku HTML, który zawiera tekst, informacjê o rozmieszczeniu elementów dokumentu oraz 
pliki bêd±ce reprezentacj± takich elementów dokumentu jak grafika czy d¼wiêk. Poniewa¿ HTTP nie rozró¿nia typów 
transmitowanych plików aplikacja serwera WWW jest do¶æ prosta w porównaniu do aplikacji przegl±darki, która musi 
zinterpretowaæ tre¶æ pliku HTML i odpowiednio rozmie¶ciæ na ekranie elementy dokumentu.

Istniej± dwa rodzaje komunikatów wymienianych pomiêdzy klientem a serwerem HTTP: ¿±dania i odpowiedzi. 
Format ¿±dania HTTP ma nastêpuj±cy format:\\
	
	Linia--¿±danie\\
	Nag³ówki (0 lub wiêcej)\\
	<Linia pusta>\\
	Korpus (tylko dla ¿±dania POST) \\

Format linii--¿±dania jest natomiast taki:\\
	
Dostêpne s± trzy ró¿ne ¿±dania HTTP:
\begin{itemize}
\item ¿±danie GET, które zwraca dowoln± informacjê (dokument) okre¶lon± przez nastêpuj±cy po nim URL;
\item ¿±danie HEAD, które zwraca tylko nag³ówek wskazanego dokumentu, ten typ ¿±dania wykorzystywany jest do sprawdzania 
odsy³aczy pod k±tem aktualno¶ci lub dostêpno¶ci;
\item ¿±danie POST u¿ywane do przesy³ania danych od klienta do serwera np. przesy³ania zawarto¶ci formularzy wype³nianych 
interakcyjnie przez u¿ytkownika. Jest to jedyne ¿±danie wraz z którym przesy³any jest korpus komunikatu.
\end{itemize}

Format odpowiedzi HTTP jest nastêpuj±cy:\\

	Linia--stanu\\
	Nag³ówki (0 lub wiêcej)\\
	<Linia pusta>\\
	Korpus\\

Format linii--stanu (status--line) ma nastêpuj±cy format:\\

	Wersja--HTTP kod--odpowiedzi fraza--odpowiedzi.\\

HTTP definiuje 17 ró¿nych nag³ówków, które dzielimy na 3 rodzaje: nag³ówki u¿ywane z ¿±daniami, nag³ówki u¿ywane 
z odpowiedziami, nag³ówki okre¶laj±ce korpus (przesy³ane dane). Niektóre nag³ówki mog± byæ u¿ywane zarówno z 
¿±daniami jak i odpowiedziami (np. nag³ówek DATE). Przyk³adowym nag³ówkiem wystêpuj±cym z ¿±daniem jest nag³ówek 
IF-MODIFIED-SINCE, który wraz z nastêpuj±cym po nim nag³ówkiem DATE stanowi element tzw. warunkowego ¿±dania 
GET. URL wystêpuj±cy w takim ¿±daniu jest otwierany tylko w przypadku je¶li by³ zmodyfikowany po wymienionej w 
¿±daniu dacie. Jednym z nag³ówków u¿ywanym z odpowiedziami jest LOCATION. Jego korpus stanowi nowy URL 
dokumentu, którego dotyczy³o poprzednie zapytanie. Przyk³adem nag³ówka okre¶laj±cego korpus jest LAST-MODIFIED. 
Nastêpuje po nim nag³ówek DATE, który podaje datê ostatniej modyfikacji dokumentu.
\begin{figure}[h]
\centering
\includegraphics[width=5in]{./rysunki/polaczenia_w_sieci_www.eps}
\caption{Schemat po³±czeñ w sieci WWW}
\label{polaczenia_www}
\end{figure}

Pierwsza linia odpowiedzi serwera nazywana jest lini± stanu. Rozpoczyna j± okre¶lenie wersji HTTP, nastêpnie 
podana jest trzycyfrowa liczba okre¶laj±ca kod odpowiedzi, a na koñcu czytelne dla u¿ytkownika wyra¿enie. 
Poni¿sza tabela przedstawia znaczenie poszczególnych kodów odpowiedzi.

Starsze specyfikacje protoko³u (HTTP 0.9 i HTTP 1.0) u¿ywa³y osobnego po³±czenia TCP do pobrania ka¿dego 
elementu (pliku) wchodz±cego w sk³ad dokumentu. Najnowsza wersja HTTP 1.1 umo¿liwia stosowanie sta³ego, 
podzielonego na sesje po³±czenia TCP do pobrania ca³ego dokumentu.

Poni¿ej omówiono istotne ze wzglêdu na wydajno¶æ WWW cechy protoko³u HTTP.

\subsection{W³a¶ciwo¶ci ruchu generowanego przez HTTP, a wydajno¶æ WWW}

W okresie od stycznia 1994 do kwietnia 1995 udzia³ komunikatów HTTP w¶ród wszystkich pakietów przesy³anych 
w szkieletowej sieci NSFNET wzrós³ z 3\% do 36\% i warto¶æ ta wykazywa³a sta³± tendencjê wzrostow±. 

Badania prowadzone w USA wykaza³y niezale¿n± od stopnia obci±¿enia serwera proporcjê pomiêdzy 
poszczególnymi typami ¿±dañ klienta. ¯±dania typu GET stanowi± ok. 99\% ogó³u komunikatów przetwarzanych przez 
serwer. 0,85\% komunikatów to ¿±dania typu HEAD. Pozosta³e 0,15\% stanowi± ¿±dania POST. 

Je¶li chodzi o odpowiedzi to 78\% do 92\% stanowi± odpowiedzi typu 20x (odpowiedzi typu ,,sukces''). Odpowied¼ typu 
304 obejmuj± 4\% do 14\% wysy³anych przez serwer komunikatów. £±cznie odpowiedzi typu 20x i 304 stanowi± 92\% do 
97\% ogó³u odpowiedzi. W przypadku pozosta³ych typów odpowiedzi ró¿nice s± ju¿ znaczne w zale¿no¶ci od rodzaju 
informacji na serwerze i jego popularno¶ci. Np. odpowiedzi 301 i 302 mog± mieæ 0,3\% udzia³ w odpowiedziach 
popularnego serwera publikuj±cego informacje naukowe NCSA (ang. \emph{National Center for Supercomputer Applications}) 
do nawet 4,2\% w przypadku niewielkiego serwera uniwersyteckiego w Calgary. Odpowiedzi typu 40x i 50x stanowi± 
zwykle od 1\% do 4\%. 

Typowo ilo¶æ danych przesy³anych w po³±czeniu HTTP jest niewielka. ¯±dania klienta nie przekraczaj± kilkuset 
bajtów, a pojedyncza odpowied¼ serwera rzadko kiedy przekracza 10 kB.

Ciekawych informacji dostarczyæ mo¿e analiza pomiaru czasu RTT (ang. \emph{Round Trip Time}), czyli ³±cznego czasu 
wymiany pakietu na drodze serwer -- klient -- serwer. Warto¶æ ta jest u¿ywana przez TCP do wyznaczenia czasu 
retransmisji segmentu w przypadku braku potwierdzenia odbioru. Przybli¿enie tego czasu mo¿na uzyskaæ dokonuj±c 
pomiaru czasu trwania fazy zamykania po³±czenia TCP. Przytoczone tu wyniki otrzymano mierz±c ten czas dla 19 
ty¶. po³±czeñ wykonanych przez 810 ró¿nych klientów na terenie USA. Najmniejsza warto¶æ wynios³a 0 sekund dla 
hosta lokalnego a najwiêksza 12,3 sekundy. Warto¶æ ¶rednia by³a równa 0,445 sekundy a mediana 0,187 sekundy. 
Wyniki te s± zadziwiaj±ce je¶li wzi±æ pod uwagê, ¿e teoretyczny RTT pomiêdzy wschodnim i zachodnim wybrze¿em USA 
wynosi 0,06 sekundy. Odpowiedzialno¶æ za ten fakt ponosiæ mo¿e znaczna ilo¶æ klientów pod³±czonych poprzez modem 
(najszybszy nawet modem wprowadza ok. 0.2 sekundy opó¼nienia do ka¿dego pojedynczego pomiaru warto¶ci RTT). 

Cech± bardzo niekorzystnie wp³ywaj±c± na wydajno¶æ HTTP w jego starszych wersjach by³a konieczno¶æ otwierania 
osobnego po³±czenia TCP dla ka¿dego elementu dokumentu. Wiele zale¿a³o tutaj od konstrukcji przegl±darki. Je¶li 
nie otwiera³a ona po³±czeñ równoczesnych to pobranie ca³ego dokumentu wyd³u¿a³o siê o czas konieczny na kolejne 
nawi±zywanie i zamykanie po³±czeñ. Je¶li z drugiej strony przegl±darka ,,agresywnie'' otwiera³a zbyt wiele 
po³±czeñ równoczesnych, to barier± stawa³a siê przepustowo¶æ po³±czenia z Internetem i wielko¶æ MSS oferowana 
przez serwer. Znany jest przyk³ad przegl±darki NCSA Mosaic, która potrafi³a otworzyæ kilkana¶cie równoczesnych 
po³±czeñ TCP dla pobrania pojedynczego dokumentu, powoduj±c tym zarówno zatory w sieci lokalnej jak i 
niepotrzebne obci±¿enie serwera. 

Otwieranie zbyt wielu po³±czeñ równoczesnych nie przynosi spodziewanych korzy¶ci. Podstawowym 
problemem wydajno¶ci HTTP wydaje siê byæ niedopasowanie protoko³u TCP -- zorientowanego na przesy³anie strumienia 
bajtów i us³ugi WWW zorientowanej na przesy³anie wyodrêbnionych komunikatów. Nale¿y pamiêtaæ ¿e HTTP, który jest 
w rzeczywisto¶ci protoko³em przesy³ania plików, mia³ w swych za³o¿eniach zapewniaæ wydajno¶æ wiêksz± ni¿ 
protokó³ FTP. Chciano uzyskaæ to eliminuj±c wystêpuj±ce w FTP dodatkowe po³±czenie steruj±ce (port 21) i 
konieczno¶æ nawi±zywania po³±czenia TCP na dwóch portach. 

Niestety TCP wymaga zestawienia po³±czenia przed faktycznym rozpoczêciem transmisji. Wprowadza to opó¼nienie o 
warto¶ci ok. 1 RTT przed przes³aniem pliku. Dodatkowo w starszych wersjach HTTP pobranie dokumentu wymaga³o 
otwieranie nowego po³±czenia TCP dla ka¿dego pliku sk³adowego, co oznacza, ¿e nale¿a³o zamykaæ po³±czenia przez 
które wys³ano wcze¶niejsze elementy dokumentu. Ka¿dorazowe zamykanie i otwieranie po³±czeñ wprowadza opó¼nienie 
rzêdu 3RTT dla ka¿dego pliku sk³adowego. HTTP 1.1 u¿ywa sta³ego ³±cza TCP dla dokumentu, co zredukowa³o 
opó¼nienie przed rozpoczêciem transferu kolejnego elementu dokumentu do 1RTT. Dodatkowo HTTP 1.1 umo¿liwia 
wysy³anie ¿±dañ potokowych tzn. wysy³anie ¿±dañ o kolejne pliki przed rozpoczêciem odbierania poprzednio 
¿±danych elementów dokumentu. Niestety w przypadku plików dynamicznych np. plików wynikowych skryptu CGI potok 
taki jest wstrzymywany. 